<!DOCTYPE html>
<html>
<head>
    <title>Test Report for locustfile.py</title>
    <link rel="shortcut icon" href="../static/img/favicon.ico" type="image/x-icon"/>
    <style>
        body {
            background: #173529;
        }
        .container {
            width: 1000px;
            margin: 0 auto;
            padding: 10px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 14px;
            color: #ecf3ee;
        }

        .info span {
            color: #b3c3bc;
        }

        .charts-container .chart {
            width: 100%;
            height: 350px;
            margin-bottom: 30px;
        }

        .download {
            float: right;
        }

        .download a {
            color: #00ca5a;
        }
        
        /* tables.css */
table.stats {
  width: 100%;
  border-radius: 3px;
  border: 2px solid #11251c;
  border-spacing: 0;
  margin-bottom: 30px;
}
table.stats thead {
  padding: 0;
  margin: 0;
  color: #a9c5ba;
}
table.stats thead tr {
  background: #11251c;
}
table.stats thead tr:nth-child(even) {
  background: #11251c;
}
table.stats thead tr:hover {
  background: #11251c;
}
table.stats thead th {
  font-weight: bold;
  cursor: default;
}
table.stats thead th.nowrap {
  white-space: nowrap;
}
table.stats thead th[data-sortkey] {
  cursor: pointer;
}
table.stats tr:hover {
  background: #1d4434;
}
table.stats tr td, table.stats tr th {
  padding: 10px;
  margin: 0;
  text-align: left;
}
table.stats tr td:first-child, table.stats tr th:first-child {
  padding-left: 16px;
}
table.stats tr td:last-child, table.stats tr th:last-child {
  padding-right: 16px;
}
table.stats tr td.numeric, table.stats tr th.numeric {
  text-align: right;
}
table.stats tr td {
  max-width: 450px;
  overflow: hidden;
  word-wrap: break-word;
  white-space: no-wrap;
  text-overflow: ellipsis;
}
@media (max-width: 1100px) {
  table.stats tr td {
    max-width: 350px;
  }
}
table.stats tr:nth-child(even) {
  background: #153126;
}
table.stats tr:nth-child(even):hover {
  background: #1d4434;
}
table.stats tr.total {
  background: #11251c;
}
table.stats tr.total td {
  font-weight: bold;
}

/*# sourceMappingURL=tables.css.map */



    </style>
</head>
<body>
    <div class="container">
        <h1>Locust Test Report</h1>

        <div class="info">
            
            <p>During: <span class="l10n datetime">2022-10-03 11:20:01</span> - <span class="l10n datetime">2022-10-03 11:21:23</span></p>
            <p>Target Host: <span>http://localhost:3104</span></p>
            <p>Script: <span>locustfile.py</span></p>
        </div>

        <div class="requests">
            <h2>Request Statistics</h2>
            <table class="stats">
                <thead>
                    <tr>
                        <th class="sortable">Method</th>
                        <th class="sortable">Name</th>
                        <th class="sortable"># Requests</th>
                        <th class="sortable"># Fails</th>
                        <th class="sortable">Average (ms)</th>
                        <th class="sortable">Min (ms)</th>
                        <th class="sortable">Max (ms)</th>
                        <th class="sortable">Average size (bytes)</th>
                        <th class="sortable">RPS</th>
                        <th class="sortable">Failures/s</th>
                    </tr>
                </thead>
                <tbody>
                    
                        <tr>
                            <td>GET</td>
                            <td>/</td>
                            <td>499</td>
                            <td>0</td>
                            <td>164</td>
                            <td>133</td>
                            <td>293</td>
                            <td>40</td>
                            <td>6.1</td>
                            <td>0.0</td>
                        </tr>
                    
                        <tr class="total">
                            <td></td>
                            <td>Aggregated</td>
                            <td>499</td>
                            <td>0</td>
                            <td>164</td>
                            <td>133</td>
                            <td>293</td>
                            <td>40</td>
                            <td>6.1</td>
                            <td>0.0</td>
                        </tr>
                    
                </tbody>
            </table>
        </div>

        <div class="responses">
            <h2>Response Time Statistics</h2>
            <table class="stats">
                <thead>
                    <tr>
                        <th class="sortable">Method</th>
                        <th class="sortable">Name</th>
                        <th class="sortable">50%ile (ms)</th>
                        <th class="sortable">60%ile (ms)</th>
                        <th class="sortable">70%ile (ms)</th>
                        <th class="sortable">80%ile (ms)</th>
                        <th class="sortable">90%ile (ms)</th>
                        <th class="sortable">95%ile (ms)</th>
                        <th class="sortable">99%ile (ms)</th>
                        <th class="sortable">100%ile (ms)</th>
                    </tr>
                </thead>
                <tbody>
                    
                        <tr>
                            <td>GET</td>
                            <td>/</td>
                            <td>150</td>
                            <td>150</td>
                            <td>160</td>
                            <td>200</td>
                            <td>240</td>
                            <td>240</td>
                            <td>270</td>
                            <td>290</td>
                        </tr>
                    
                        <tr class="total">
                            <td></td>
                            <td>Aggregated</td>
                            <td>150</td>
                            <td>150</td>
                            <td>160</td>
                            <td>200</td>
                            <td>240</td>
                            <td>240</td>
                            <td>270</td>
                            <td>290</td>
                        </tr>
                    
                </tbody>
            </table>
        </div>

        

        

        
            <div class="charts-container">
                <h2>Charts</h2>
            </div>
        

        <div id="tasks">
            <h2>Final ratio</h2>
            <div class="tasks" data-tasks="{&quot;per_class&quot;: {&quot;HelloWorldUser&quot;: {&quot;ratio&quot;: 1.0, &quot;tasks&quot;: {&quot;hello_world&quot;: {&quot;ratio&quot;: 1.0}}}}, &quot;total&quot;: {&quot;HelloWorldUser&quot;: {&quot;ratio&quot;: 1.0, &quot;tasks&quot;: {&quot;hello_world&quot;: {&quot;ratio&quot;: 1.0}}}}}"></div>
        </div>

    </div>

    
    
    <script src="./jquery.js"></script>
    <script src="./echarts.js"></script>
    
    
    <script>
        

// vintage.js
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['exports', 'echarts'], factory);
    } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {
        // CommonJS
        factory(exports, require('echarts'));
    } else {
        // Browser globals
        factory({}, root.echarts);
    }
}(this, function (exports, echarts) {
    var log = function (msg) {
        if (typeof console !== 'undefined') {
            console && console.error && console.error(msg);
        }
    };
    if (!echarts) {
        log('ECharts is not Loaded');
        return;
    }
    var colorPalette = ['#00ca5a','#ffca5a', '#d7ab82',  '#6e7074','#61a0a8','#efa18d', '#787464', '#cc7e63', '#724e58', '#4b565b'];
    echarts.registerTheme('vintage', {
        color: colorPalette,
        backgroundColor: '#132b21',
        xAxis: {lineColor: "#f00"},
        graph: {
            color: colorPalette,
        },
        textStyle: {color:"#b3c3bc"},
        title: {
            textStyle:{color:"#b3c3bc"}
        },
    });
}));


// chart.js
(function() {
    class LocustLineChart {
        /**
         * lines should be an array of line names
         */
        constructor(container, title, lines, unit, colors) {
            this.container = $(container);
            this.title = title;
            this.lines = lines;
            
            this.element = $('<div class="chart"></div>').css("width", "100%").appendTo(container);
            this.data = [];
            this.dates = [];
            
            var seriesData = [];
            for (var i=0; i<lines.length; i++) {
                seriesData.push({
                    name: lines[i],
                    type: 'line',
                    showSymbol: true,
                    hoverAnimation: false,
                    data: [],
                });
                this.data.push([]);
            }
            
            this.chart = echarts.init(this.element[0], 'vintage');
            this.chart.setOption({
                legend: {
                    icon: 'circle',
                    inactiveColor: '#b3c3bc',
                    textStyle: {
                        color: '#b3c3bc',
                    }
                },
                title: {
                    text: this.title,
                    x: 10,
                    y: 10,
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params) {
                        if (!!params && params.length > 0 && params.some(param => !!param.value)) {
                            var str = params[0].name;
                            for (var i=0; i<params.length; i++) {
                                var param = params[i];
                                str += '<br><span style="color:' + param.color + ';">' + param.seriesName + ': ' + param.data.value + '</span>';
                            }
                            if(param.data.users != undefined){
                                str += '<br><span style="color:#a3b3ac;">Users: ' + param.data.users + '</span>';
                            }
                            return str;
                        } else {
                            return "No data";
                        }
                    },
                    axisPointer: {
                        animation: true
                    },
                    textStyle: {
                        color: '#b3c3bc',
                        fontSize: 13,
                    },
                    backgroundColor: 'rgba(21,35,28, 0.93)',
                    borderWidth: 0,
                    extraCssText: "z-index:1;",
                },
                xAxis: {
                    type: 'category',
                    splitLine: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#5b6f66',
                        },
                    },
                    data: this.dates,
                },
                yAxis: {
                    type: 'value',
                    boundaryGap: [0, '5%'],
                    splitLine: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#5b6f66',
                        },
                    },
                },
                series: seriesData,
                grid: {x:60, y:70, x2:40, y2:40},
                color: colors,
                toolbox: {
                    feature: {
                        saveAsImage: {
                            name: this.title.replace(/\s+/g, '_').toLowerCase() + '_' + Date.parse(new Date()) / 1000,
                            title: "Download as PNG"
                        }
                    }
                }
            })
        }
        
        addValue(values, user_count=0) {
            this.dates.push(new Date().toLocaleTimeString());
            var seriesData = [];
            for (var i=0; i<values.length; i++) {
                var value = Math.round(values[i] * 100) / 100;
                this.data[i].push({"value": value, "users": user_count});
                seriesData.push({data: this.data[i]});
            }
            this.chart.setOption({
                xAxis: {
                    data: this.dates,
                },
                series: seriesData
            });
        }
        
        resize() {
            this.chart.resize();
        }
    }
    window.LocustLineChart = LocustLineChart;
})();



// tasks.js
function getRatioPercent(ratio) {
    return (ratio * 100).toFixed(1) + "%";
}

function _initTasks_sub(li, tasks) {
    if (tasks) {
        var ul = $('<ul></ul>');
        for (const [key, task] of Object.entries(tasks)) {
            var liTask = $('<li></li>').text(getRatioPercent(task.ratio) + " " + key);
            _initTasks_sub(liTask, task.tasks);
            ul.append(liTask);
        }
        li.append(ul);
    }
}

function _getTasks_div(root, title) {
    var taskDiv = $('<div></div>');
    var taskDivHeading = $('<h3></h3>').text(title);
    taskDiv.append(taskDivHeading);
    var ulClasses = $('<ul></ul>');
    for (const [key, clazz] of Object.entries(root)) {
        var liClass = $('<li></li>').text(getRatioPercent(clazz.ratio) + " " + key);
        _initTasks_sub(liClass, clazz.tasks)
        ulClasses.append(liClass);
    }
    taskDiv.append(ulClasses);
    return taskDiv
}

function _renderTasks(data) {
    var tasks = $('#tasks .tasks');
    tasks.empty();
    tasks.append(_getTasks_div(data.per_class, 'Ratio per User class'));
    tasks.append(_getTasks_div(data.total, 'Total ratio'));
}

function fillTasksFromObj() {
    var tasks = $('#tasks .tasks')
    var data = tasks.data('tasks');
    _renderTasks(data)
}

function fillTasksFromRequest() {
    $.get('./tasks', function (data) {
        _renderTasks(data)
    });
}



    </script>

    <script>
        
var stats_history = {
    "time": ["11:20:06", "11:20:11", "11:20:16", "11:20:21", "11:20:26", "11:20:31", "11:20:36", "11:20:41", "11:20:46", "11:20:51", "11:20:56", "11:21:01", "11:21:06", "11:21:11", "11:21:16", "11:21:21"].map(server_time => new Date(new Date().setUTCHours(...(server_time.split(":")))).toLocaleTimeString()),
    "user_count": [{"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}, {"value": 1}],
    "current_rps": [{"users": 1, "value": 4.666666666666667}, {"users": 1, "value": 5.125}, {"users": 1, "value": 5.9}, {"users": 1, "value": 6.3}, {"users": 1, "value": 6.2}, {"users": 1, "value": 6.2}, {"users": 1, "value": 6.1}, {"users": 1, "value": 6.1}, {"users": 1, "value": 6.1}, {"users": 1, "value": 6.1}, {"users": 1, "value": 6.0}, {"users": 1, "value": 6.1}, {"users": 1, "value": 6.0}, {"users": 1, "value": 5.9}, {"users": 1, "value": 6.2}, {"users": 1, "value": 6.1}],
    "current_fail_per_sec": [{"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}, {"users": 1, "value": 0}],
    "response_time_percentile_50": [{"users": 1, "value": 160.0}, {"users": 1, "value": 160.0}, {"users": 1, "value": 140.0}, {"users": 1, "value": 140.0}, {"users": 1, "value": 140.0}, {"users": 1, "value": 140.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 150.0}, {"users": 1, "value": 140.0}, {"users": 1, "value": 150.0}],
    "response_time_percentile_95": [{"users": 1, "value": 210.0}, {"users": 1, "value": 230.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 250.0}, {"users": 1, "value": 250.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 250.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 240.0}, {"users": 1, "value": 250.0}, {"users": 1, "value": 250.0}],
    "markers": [],
};
        var rpsChart = new LocustLineChart($(".charts-container"), "Total Requests per Second", ["RPS", "Failures/s"], "reqs/s", ['#00ca5a', '#ff6d6d']);
        var responseTimeChart = new LocustLineChart($(".charts-container"), "Response Times (ms)", ["Median Response Time", "95% percentile"], "ms");
        var usersChart = new LocustLineChart($(".charts-container"), "Number of Users", ["Users"], "users");

        if(stats_history["time"].length > 0){
            rpsChart.chart.setOption({
                xAxis: {data: stats_history["time"]},
                series: [
                    {data: stats_history["current_rps"]},
                    {data: stats_history["current_fail_per_sec"]},
                ]
            });

            responseTimeChart.chart.setOption({
                xAxis: {data: stats_history["time"]},
                series: [
                    {data: stats_history["response_time_percentile_50"]},
                    {data: stats_history["response_time_percentile_95"]},
                ]
            });

            usersChart.chart.setOption({
                xAxis: {
                    data: stats_history["time"]
                },
                series: [
                    {data: stats_history["user_count"]},
                ]
            });
        }

        $(".l10n.datetime").html((index, currentContent) => {
            if (!currentContent || !currentContent.includes(" ") || !currentContent.includes(":")) {
                return currentContent;
            }

            return new Date(Date.parse(currentContent.replace(" ", "T") + ".000Z")).toLocaleString();
        });

        fillTasksFromObj()
    </script>

    <script>
        $('.sortable').click(function() {
            var table = $(this).parents('table').eq(0)
            var rowArray = table.find('tr:gt(0)').toArray()
            var aggregatedRow = rowArray.pop()
            var rows = rowArray.sort(comparer($(this).index()))
            this.asc = !this.asc
            if (!this.asc){rows = rows.reverse()}
            for (var i = 0; i < rows.length; i++){table.append(rows[i])}
            table.append(aggregatedRow)
        })
        function comparer(index) {
            return function(a,b) {
                var valA = getCellValue(a, index), valB = getCellValue(b, index)
                return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.toString().localeCompare(valB)
            }
        }
        function getCellValue(row, index) { return $(row).children('td').eq(index).text() }
    </script>
</body>
</html>